<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    body {
        font-family: Arial, Helvetica, sans-serif;
        font-size: 15px;
    }

    .board {
        position: absolute;
        top: 60px;
        left: 130px;
    }

    .board > div {
        display: flex;
        flex-direction: row;
    }

    .board > div > div {
        width: 50px;
        height: 50px;
        outline: 1px solid black;
        flex-shrink: 0;
    }

    .pieces {
        position: absolute;
        top: 35px;
        left: 105px;
    }

    .pieces > div {
        display: flex;
        flex-direction: row;
    }

    .pieces > div > div {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 50px;
        height: 50px;
        flex-shrink: 0;
    }

    .pieces > div > div > span {
        width: 40px;
        height: 40px;
        border-radius: 20px;
    }

    .pieces > div > div > span:hover {
        background-color: gray;
    }

    .playerIcon {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 5px;
    }

    #undo {
        display: inline-block;
        width: 60px;
        height: 60px;
        margin: 10px;
    }

</style>

<body>

    <div>
        <div>Current Player: <span id="currentPlayer" class="playerIcon"></span></div>
        <div class="playerCounts">
        </div>
    </div>
    <button id="undo">undo</button>

    <div class="board">
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <div>
            <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
    </div>

    <div class="pieces">
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
        <div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div> <div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div><div><span></span></div></div>
    </div>
    
</body>

<script>

    const CONFIG = {
        // playerCount: 4,
        // colors: ['blue', 'green', 'red', 'orange'],
        // playerCount: 3,
        // colors: ['blue', 'green', 'red'],
        playerCount: 2,
        colors: ['blue', 'green'],
        // playerCount: 1,
        // colors: ['blue'],
        rowLength: 19,
        columnHeight:19 
    }

    const PIECE_STATUS = {
        disabled: 0,
        enabled: 1
    }

    class Game {
        constructor(players) {
            this.currentPlayerIdx = 0;
            this.previousPiece;
            this.players = players;
            this.board;
            this.directions = {
                up: {x: 0, y: -1},
                down: {x: 0, y: 1},
                left: {x: -1, y: 0},
                right: {x: 1, y: 0},
                rightUp: {x: 1, y: -1},
                leftDown: {x: -1, y: 1},
                leftUp: {x: -1, y: -1},
                rightDown: {x: 1, y: 1},
            }
            this.currentPlayerElement = document.querySelector('#currentPlayer');
            this.playerCounts = document.querySelector('.playerCounts');
            document.querySelector('#undo').onclick = this.undo.bind(this);
            this.updateControls();
        }

        undo() {
            if (this.previousPiece) {
                this.previousPiece.clear();
                this.previousPiece = null;
                if (this.currentPlayerIdx === 0) {
                    this.currentPlayerIdx = this.players.length - 1;
                } else {
                    this.currentPlayerIdx--;
                }
                this.updateControls();
            }
        }

        updateControls() {
            this.currentPlayerElement.style.backgroundColor = this.players[this.currentPlayerIdx].color;
            this.createControls();
        }

        createControls() {
            this.playerCounts.innerHTML = '';
            for (const player of this.players) {
                const span = document.createElement('span');
                span.className += 'playerIcon';
                span.style.backgroundColor = player.color;
                const count = document.createElement('span');
                count.appendChild(document.createTextNode(`:${player.captures} `));
                this.playerCounts.appendChild(span);
                this.playerCounts.appendChild(count);
            }
        }

        play(piece) {
            if (piece.status === PIECE_STATUS.disabled) {
                const player = this.players[this.currentPlayerIdx];
                piece.play(player);
                this.previousPiece = piece;
                this.checkCapture(piece, player);
                this.checkWin(piece, player, 0);
                this.nextTurn();
                this.updateControls();
            } else {
                console.log('existing piece');
            }
        }

        checkCapture(piece, player) {
            for (const direction in this.directions) {
                const a = this.checkDirection(piece.coords.x, piece.coords.y, player, this.directions[direction]);
                if (a.length >= 3 && a[0].player !== player && a[0].player === a[1].player && a[2].player === player) {
                    player.captures++;
                    a[0].clear();
                    a[1].clear();
                    this.previousPiece = null;
                }
            }
        }

        checkDirection(x, y, player, direction, pieces = []) {
            const newY = y + direction.y;
            const newX = x + direction.x;
            if (newY >= 0 && newY < CONFIG.columnHeight && newX >= 0 && newX < CONFIG.rowLength) {
                const piece = this.board[newY][newX];
                if (piece.player) {
                    pieces.push(piece)
                    return this.checkDirection(newX, newY, player, direction, pieces)
                }
            }
            return pieces;
        }

        nextTurn() {
            if (this.currentPlayerIdx === this.players.length - 1) {
                this.currentPlayerIdx = 0;
            } else {
                this.currentPlayerIdx++;
            }
        }

        checkWin(piece, player, inline) {
            const x = piece.coords.x;
            const y = piece.coords.y;

            const horizontal = 1+ this.checkRight(x, y, player, 0) + this.checkLeft(x, y, player, 0);
            const vertical = 1 + this.checkUp(x, y, player, 0) + this.checkDown(x, y, player, 0);
            const diag1 = 1 + this.checkDiagLeftUp(x, y, player, 0) + this.checkDiagRightDown(x, y, player, 0);
            const diag2 = 1 + this.checkDiagRightUp(x, y, player, 0) + this.checkDiagLeftDown(x, y, player, 0);

            const inRow = Math.max(vertical, horizontal, diag1, diag2);
            if (inRow >= 5) {
                console.log(`${player.color} wins with ${inRow} in a row`);
            }

        }

        checkUp(x, y, p, count) {
            const newY = y - 1;
            if (newY >= 0) {
                const piece = this.board[newY][x];
                if (piece.player === p) {
                    return this.checkUp(x, newY, p, count + 1)
                }
            }
            return count;
        }

        checkDown(x, y, p, count) {
            const newY = y + 1;
            if (newY < CONFIG.columnHeight) {
                const piece = this.board[newY][x];
                if (piece.player === p) {
                    return this.checkDown(x, newY, p, count + 1)
                }
            }
            return count;
        }

        checkRight(x, y, p, count) {
            const newX = x + 1;
            if (newX < CONFIG.rowLength) {
                const piece = this.board[y][newX];
                if (piece.player === p) {
                    return this.checkRight(newX, y, p, count + 1)
                }
            }
            return count;
        }

        checkLeft(x, y, p, count) {
            const newX = x - 1;
            if (newX >= 0) {
                const piece = this.board[y][newX];
                if (piece.player === p) {
                    return this.checkLeft(newX, y, p, count + 1)
                }
            }
            return count;
        }

        checkDiagRightUp(x, y, p, count) {
            const newX = x + 1;
            const newY = y - 1;
            if (newX < CONFIG.rowLength && newY >= 0) {
                const piece = this.board[newY][newX];
                if (piece.player === p) {
                    return this.checkDiagRightUp(newX, newY, p, count + 1)
                }
            }
            return count;
        }

        checkDiagLeftDown(x, y, p, count) {
            const newX = x - 1;
            const newY = y + 1;
            if (newX >= 0 && newY < CONFIG.columnHeight) {
                const piece = this.board[newY][newX];
                if (piece.player === p) {
                    return this.checkDiagLeftDown(newX, newY, p, count + 1)
                }
            }
            return count;
        }

        checkDiagLeftUp(x, y, p, count) {
            const newX = x - 1;
            const newY = y - 1;
            if (newX >= 0 && newY >= 0) {
                const piece = this.board[newY][newX];
                if (piece.player === p) {
                    return this.checkDiagLeftUp(newX, newY, p, count + 1)
                }
            }
            return count;
        }

        checkDiagRightDown(x, y, p, count) {
            const newX = x + 1;
            const newY = y + 1;
            if (newX < CONFIG.rowLength && newY < CONFIG.columnHeight) {
                const piece = this.board[newY][newX];
                if (piece.player === p) {
                    return this.checkDiagRightDown(newX, newY, p, count + 1)
                }
            }
            return count;
        }

        printBoard() {
            console.log(this.board);
        }

    }

    class Piece {
        constructor(element, play, coords) {
            this.element = element;
            this.status = PIECE_STATUS.disabled;
            this.element.onclick = () => play(this);
            this.coords = coords;
        }

        play(player) {
            this.setColor(player.color);
            this.player = player;
            this.status = PIECE_STATUS.enabled;

        }

        setColor(color) {
            this.element.style.backgroundColor = color;
        }

        clear() {
            this.player = null;
            this.status = PIECE_STATUS.disabled;
            this.setColor(null);
        }
    }


    class Player {
        constructor (color) {
            this.color = color;
            this.captures = 0;
        }
    }

    const getPlayers = (config) => {
        const players = [];
        for (let i = 0; i < config.playerCount; i++) {
            players.push(new Player(config.colors[i]));
        }
        return players;
    };
    const game = new Game(getPlayers(CONFIG));

    const getBoard = (config) => {
        const nodeList = [...document.querySelectorAll('.pieces > div > div > span')];
        const board = [];
        for (let i = 0; i < config.columnHeight; i++) {
            board.push([]);
        }
        for (let i = 0; i < nodeList.length; i++) {
            const y = Math.floor(i/CONFIG.rowLength||0);
            const x = i - (CONFIG.rowLength * y);
            const piece = new Piece(nodeList[i], game.play.bind(game), {x: x, y: y});
            board[y].push(piece);
        }
        return board;
    }

    game.board = getBoard(CONFIG);
    game.printBoard();


</script>
</html>